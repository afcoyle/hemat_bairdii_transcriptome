---
title: "12_kallisto_to_deseq_to_accessionIDs"
author: "Aidan Coyle"
date: "Last compiled on `r format(Sys.time(), '%Y-%m-%d')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Originally written 2021/01/18
Roberts Lab, UW-SAFS
Written for analysis of _Hematodinium_ differential gene expression

**IMPORTANT: Many code blocks have been set to eval = FALSE due to long runtimes. To re-run analysis, change those blocks to TRUE**

# Purpose:
This script utilizes a series of custom-built functions for the following: 
- running a Trinity matrix of kallisto transcript counts through DESeq2
- turning DESeq2 output into newline-separated file of UniProt accessions
- creating Venn diagrams of transcript IDs and accession IDs (not needed for future steps - can skip if not wanted)

```{r libraries, message = FALSE, warning=FALSE}
# Add all required libraries that are installed with install.packages() here
list.of.packages <- c("tidyverse", "plotly")
# Add all libraries that are installed using BiocManager here
bioconductor.packages <- c("apeglm", "DESeq2", "vsn")

# Install BiocManager if needed
if(!requireNamespace("BiocManager", quietly = TRUE)) install.packages("BiocManager")

# Get names of all required packages that aren't installed
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[, "Package"])]
new.bioc.packages <- bioconductor.packages[!(bioconductor.packages %in% installed.packages()[, "Package"])]
# Install all new packages
if(length(new.packages)) install.packages(new.packages)
if(length(new.bioc.packages)) BiocManager::install(new.bioc.packages)

# Load all required libraries
all.packages <- c(list.of.packages, bioconductor.packages)
lapply(all.packages, FUN = function(X) {
  do.call("require", list(X))
})

# Functions are defined in hematodinium_analysis_functions.R
source("hematodinium_analysis_functions.R")
```


# Stage 1: Analyzing Trinity matrix from Kallisto output with DESeq2

Almost all analysis takes place in function deseq_analysis(). Documentation in function file. If attempting to redo a specific graph or table, the file DESeq_demonstration.R may be helpful

These blocks take quite a long time to run, so **in the markdown file, I have set eval to FALSE**. I recommend only re-running blocks that you are certain you want to run - again, run times are quite lengthy.

For all code blocks, **the order of rows in temperature and day values in exp_design should match the order of columns of the `kallisto.isoforms.counts.matrix` input file from Trinity for the pairwise comparison**. As an example, here's what the `exp_design` table should look like for hypothetical libraries X (day 0, lowered temp), Y (day 2, ambient temp), and Z (day 17, elevated temp) if the `kallisto.isoforms.counts.matrix` file columns are ordered X, Y, Z:

```{r example_table}
exp_design <- data.frame(Temperature = factor(c("Decreased", "Ambient", "Elevated")),
                         Day = factor(c("Day 0", "Day 2", "Day 17")))

exp_design
```

As a further note, the pairwise comparisons performed here treat temperature as water temperature at time of sample, **not** treatment group. This means that Elevated Day 0 and Lowered Day 0 libraries are treated as **ambient-temperature libraries**, as samples were taken prior to any temperature changes. For all other samples, there are no such differences.

### Explanation of deseq_analysis():

A function to analyze Kallisto output with DESeq2. Will likely take quite long to run - there's some computationally-heavy steps involved

Takes 4 inputs

1. kallisto_path: path to matrix created by Trinity from Kallisto outputs

2. experiment_table: table with treatments in experiment. 

  + Order should match columns of matrix from Trinity

  + Example: Day and temperature data for libraries 118, 132, 178, 463, 481, 485 (in order)

  + exp_design <- data.frame(day = factor(c(0, 0, 0, 17, 17, 17)), Temperature = factor(c("Ambient", "Ambient", "Ambient", "Ambient", "Ambient", "Ambient")))

3. output_path: path to the output folder

4. variable: variable being examined. Used in creation of deseq object.

  + Should be 'day' or 'temp' (without quotes)

### Elevated Day 2 vs. Ambient Day 0+2, Individual Libraries Only
exp_design = day and temperature data for libraries 178, 118, 132, 359, 349, 334, 272, 294, 280 (in order).

```{r elev2vsamb02}
exp_design <- data.frame(Temperature = factor(c("Ambient", "Ambient", "Ambient", "Ambient", "Ambient", "Ambient",
                                         "Elev", "Elev", "Elev")),
                         day = factor(c(0, 0, 0, 2, 2, 2, 2, 2, 2)))
  
deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/elev2_vs_amb02_indiv/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/elev2_vs_amb02_indiv",
               variable = "Temperature")
```

### All Elevated and Ambient Libraries, Pooled And Individual
exp_design = day and temperature data for libraries 178, 359, 463, 118, 349, 481, 132, 334, 485, 151, 173, 072, 127, 380821, 272, 294, 280, 380825 (in order). 

```{r elevallvsamball}
exp_design <- data.frame(Temperature = factor(c("Ambient", "Ambient", "Ambient", 
                                         "Ambient", "Ambient", "Ambient",
                                         "Ambient", "Ambient", "Ambient",
                                         "Ambient", "Ambient", "Ambient",
                                         "Ambient", "Ambient", "Elev",
                                         "Elev", "Elev", "Elev")),
                             day = factor(c(0, 2, 17, 
                                            0, 2, 17, 
                                            0, 2, 17, 
                                            0, 0, 0, 
                                            0, 2, 2,
                                            2, 2, 2)))

deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/amb0217_elev0_low0_vs_elev2/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/amb0217_elev0_low0_vs_elev2",
               variable = "Temperature")
```

### Elevated Day 0 vs. Elevated Day 2, Individual Libraries Only
exp_design = day and temperature data for libraries 173, 072, 127, 272, 294, 280 (in order). 

```{r elev0vselev2}
exp_design <- data.frame(Temperature = factor(c("7.5C", "7.5C", "7.5C",
                                         "10C", "10C", "10C")))

deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/elev0_vs_elev2_indiv/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/elev0_vs_elev2_indiv",
               variable = "Temperature")
```

### Ambient Day 0 vs. Ambient Day 2, Individual Libraries Only
exp_design = day and temperature data for libraries 178, 118, 132, 359, 349, 334 (in order)

```{r amb0vsamb2}
exp_design <- data.frame(day = factor(c("Day 0", "Day 0", "Day 0",
                                        "Day 2", "Day 2", "Day 2")),
                         Temperature = factor(c("Ambient", "Ambient", "Ambient",
                                         "Ambient", "Ambient", "Ambient")))

deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/amb0_vs_amb2_indiv/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/amb0_vs_amb2_indiv",
               variable = "Day")
```

### Ambient Day 0 vs. Ambient Day 17, Individual Libraries Only
exp_design = day and temperature data for libraries 178, 118, 132, 463, 481, 485 (in order)

```{r amb0vsamb17}
exp_design <- data.frame(day = factor(c(0, 0, 0, 
                                        17, 17, 17)),
                         Temperature = factor(c("Ambient", "Ambient", "Ambient",
                                         "Ambient", "Ambient", "Ambient")))

deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/amb0_vs_amb17_indiv/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/amb0_vs_amb17_indiv",
               variable = "Day")
```

### Ambient Day 2 vs. Ambient Day 17, Individual Libraries Only
exp_design = day and temperature data for libraries 359, 349, 334, 463, 481, 485 (in order)

```{r amb2vsamb17}
exp_design <- data.frame(day = factor(c(2, 2, 2, 
                                        17, 17, 17)),
                         Temperature = factor(c("Ambient", "Ambient", "Ambient",
                                         "Ambient", "Ambient", "Ambient")))

deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/amb2_vs_amb17_indiv/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/amb2_vs_amb17_indiv",
               variable = "Day")
```

### Ambient Day 2 vs. Elevated Day 2, Individual Libraries Only
exp_design = day and temperature data for libraries 359, 349, 334, 272, 294, 280 (in order)

```{r amb2vselev2}
exp_design <- data.frame(Temperature = factor(c("Ambient", "Ambient", "Ambient",
                                         "elev", "elev", "elev")),
                         day = factor(c(2, 2, 2,
                                        2, 2, 2)))

deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/amb2_vs_elev2_indiv/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/amb2_vs_elev2_indiv",
               variable = "Temperature")
```

# Lowered Day 0 vs. Lowered Day 2, Individual Libraries Only

exp_design = day and temperature data for libraries 073, 151, 113, 221, 254, 222 (in order)

```{r low0vslow2}
exp_design <- data.frame(Day = factor(c(0, 0, 0,
                                        2, 2, 2)))

deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/low0_vs_low2_indiv/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_vs_low2_indiv",
               variable = "Day")
```

# Lowered Day 0 vs. Lowered Days 2 + 17, Individual Libraries Only

exp_design = day and temperature data for libraries 073, 151, 113, 221, 254, 222, 427, 445, 425 (in order)

```{r low0vslow217}
exp_design <- data.frame(Temperature = factor(c("Ambient", "Ambient", "Ambient",
                                                "Decreased", "Decreased", "Decreased",
                                                "Decreased", "Decreased", "Decreased")),
                         Day = factor(c(0, 0, 0,
                                        2, 2, 2,
                                        17, 17, 17)))

deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/low0_vs_low217_indiv/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_vs_low217_indiv",
               variable = "Temperature")
```

# Lowered Day 0 + Ambient Day 0/2/17 vs. Lowered Day 2/17, Individual

exp_design = day and temperature data for libraries 073, 151, 113, 178, 118, 132, 359, 349, 334, 463, 481, 485, 221, 254, 222, 427, 445, 425

```{r low0amb0217vslow217}
exp_design <- data.frame(Temperature = factor(c("Ambient", "Ambient", "Ambient",
                                                "Ambient", "Ambient", "Ambient",
                                                "Ambient", "Ambient", "Ambient",
                                                "Ambient", "Ambient", "Ambient",
                                                "Decreased", "Decreased", "Decreased",
                                                "Decreased", "Decreased", "Decreased")),
                         Day = factor(c(0, 0, 0,
                                        0, 0, 0,
                                        2, 2, 2,
                                        17, 17, 17,
                                        2, 2, 2,
                                        17, 17, 17)))

deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/low0_amb0217_vs_low217_indiv/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_amb0217_vs_low217_indiv",
               variable = "Temperature")
```

# Lowered Day 2 + 17 vs. Ambient Day 2 + 17, Individual

exp_design = day and temperature data for libraries 221, 254, 222, 427, 445, 425, 359, 349, 334, 463, 481, 485 (in order)

```{r low217vsamb217}
exp_design <- data.frame(Temperature = factor(c("Decreased", "Decreased", "Decreased",
                                                "Decreased", "Decreased", "Decreased",
                                                "Ambient", "Ambient", "Ambient",
                                                "Ambient", "Ambient", "Ambient")),
                         Day = factor(c(2, 2, 2,
                                        17, 17, 17,
                                        2, 2, 2,
                                        17, 17, 17)))

deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/low217_vs_amb217_indiv/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low217_vs_amb217_indiv",
               variable = "Temperature")
```

### Decreased Day 0 vs. Ambient Day 0, Individual Libraries Only

exp_design = day and temperature data for libraries 073, 151, 113, 178, 118, 132 (in order)

Note: In this case, "Temperature" stands for TREATMENT temperature, not ACTUAL temperature (in all others, it's the actual temperature). However, this is a test for differences in base infection rate for treatment groups.

```{r low0vsamb0}
exp_design <- data.frame(Temperature = factor(c("Decreased", "Decreased", "Decreased",
                                         "Ambient", "Ambient", "Ambient")))

deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/low0_vs_amb0_indiv/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_vs_amb0_indiv",
               variable = "Temperature")
```

### Decreased Day 0 vs. Decreased Day 17, Individual Libraries Only

exp_design = day and temperature data for libraries 178, 118, 132, 427, 445, 425 (in order)

```{r low0vlow17}
exp_design <- data.frame(Day = factor(c("Day 0", "Day 0", "Day 0", 
                                        "Day 17", "Day 17", "Day 17")))

deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/low0_vs_low17_indiv/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_vs_low17_indiv",
               variable = "Day")
```

### Decreased Day 0 + Ambient Day 0 vs. Decreased Day 17 + Ambient Day 17, Individual Libraries Only

exp_design = day and temperature data for libraries 073, 151, 113, 178, 118, 132, 427, 445, 425, #463, 481, 485 (in order)

```{r low0amb0vslow17amb17}
exp_design <- data.frame(Day = factor(c("Day 0", "Day 0", "Day 0", 
                                        "Day 0", "Day 0", "Day 0", 
                                        "Day 17", "Day 17", "Day 17",
                                        "Day 17", "Day 17", "Day 17")),
                         Temperature = factor(c("Decreased", "Decreased", "Decreased", 
                                                "Ambient", "Ambient", "Ambient", 
                                                "Decreased", "Decreased", "Decreased",
                                                "Ambient", "Ambient", "Ambient")))

deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/low0_amb0_vs_low17_amb17_indiv/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_amb0_vs_low17_amb17_indiv",
               variable = "Day")
```


### Decreased Day 0 + Elevated Day 0 vs. Decreased Day 2 + Elevated Day 2, Individual Libraries Only

exp_design = day and temperature data for libraries 073, 151, 113, 173, 072, 127, 221, 254, 222, 272, 294, 280 (in order)

```{r low0amb0vslow17amb17}
exp_design <- data.frame(Day = factor(c("Day 0", "Day 0", "Day 0", 
                                        "Day 0", "Day 0", "Day 0", 
                                        "Day 2", "Day 2", "Day 2",
                                        "Day 2", "Day 2", "Day 2")),
                         Temperature = factor(c("Decreased", "Decreased", "Decreased", 
                                                "Elevated", "Elevated", "Elevated", 
                                                "Decreased", "Decreased", "Decreased",
                                                "Elevated", "Elevated", "Elevated")))

deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/low0_elev0_vs_low2_elev2_indiv/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_elev0_vs_low2_elev2_indiv",
               variable = "Day")
```

### All Individual Libraries
exp_design = day and temperature data for libraries 178, 359, 463, 118, 349, 481, 132, 334, 485, 073, 221, 427, 151, 254, 445, 113, 222, 425, 173, 272, 072, 294, 127, 280. 

That corresponds to Crab A Day 0, Crab A Day 2, Crab A Day 17, Crab B Day 0, Crab B Day 2... for crabs A-I in alphabetical order

#### Temperature as variable

Using temperature at time of sampling, not treatment  group

```{r all_libs_temp, eval = FALSE}
exp_design <- data.frame(Temperature = factor(c("Ambient", "Ambient", "Ambient",
                                         "Ambient", "Ambient", "Ambient",
                                         "Ambient", "Ambient", "Ambient",
                                         "Ambient", "low", "low",
                                         "Ambient", "low", "low",
                                         "Ambient", "low", "low",
                                         "Ambient", "elev", "Ambient",
                                         "elev", "Ambient", "elev")),
                         Day = factor(c(0, 2, 17,
                                        0, 2, 17,
                                        0, 2, 17,
                                        0, 2, 17,
                                        0, 2, 17, 
                                        0, 2, 17, 
                                        0, 2, 0, 
                                        2, 0, 2)),
                         crab = factor(c(rep("A", times = 3),
                                         rep("B", times = 3),
                                         rep("C", times = 3),
                                         rep("D", times = 3),
                                         rep("E", times = 3),
                                         rep("F", times = 3),
                                         rep("G", times = 2),
                                         rep("H", times = 2),
                                         rep("I", times = 2))))

deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/all_indiv_libraries/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/all_indiv_libraries/temp_as_var/",
               variable = "Temperature")
```


#### Crab as variable


```{r all_libs_crab, eval = FALSE}
exp_design <- data.frame(Temperature = factor(c("Ambient", "Ambient", "Ambient",
                                         "Ambient", "Ambient", "Ambient",
                                         "Ambient", "Ambient", "Ambient",
                                         "Ambient", "low", "low",
                                         "Ambient", "low", "low",
                                         "Ambient", "low", "low",
                                         "Ambient", "elev", "Ambient",
                                         "elev", "Ambient", "elev")),
                         Day = factor(c(0, 2, 17,
                                        0, 2, 17,
                                        0, 2, 17,
                                        0, 2, 17,
                                        0, 2, 17, 
                                        0, 2, 17, 
                                        0, 2, 0, 
                                        2, 0, 2)),
                         crab = factor(c(rep("A", times = 3),
                                         rep("B", times = 3),
                                         rep("C", times = 3),
                                         rep("D", times = 3),
                                         rep("E", times = 3),
                                         rep("F", times = 3),
                                         rep("G", times = 2),
                                         rep("H", times = 2),
                                         rep("I", times = 2))))

deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/all_indiv_libraries/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/all_indiv_libraries/crab_as_var/",
               variable = "crab")
```

#### Day as variable


```{r all_libs_day, eval = FALSE}
exp_design <- data.frame(Temperature = factor(c("Ambient", "Ambient", "Ambient",
                                         "Ambient", "Ambient", "Ambient",
                                         "Ambient", "Ambient", "Ambient",
                                         "Ambient", "low", "low",
                                         "Ambient", "low", "low",
                                         "Ambient", "low", "low",
                                         "Ambient", "elev", "Ambient",
                                         "elev", "Ambient", "elev")),
                         Day = factor(c(0, 2, 17,
                                        0, 2, 17,
                                        0, 2, 17,
                                        0, 2, 17,
                                        0, 2, 17, 
                                        0, 2, 17, 
                                        0, 2, 0, 
                                        2, 0, 2)),
                         crab = factor(c(rep("A", times = 3),
                                         rep("B", times = 3),
                                         rep("C", times = 3),
                                         rep("D", times = 3),
                                         rep("E", times = 3),
                                         rep("F", times = 3),
                                         rep("G", times = 2),
                                         rep("H", times = 2),
                                         rep("I", times = 2))))

deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/all_indiv_libraries/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/all_indiv_libraries/day_as_var/",
               variable = "Day")
```

#### Infection as variable


```{r all_libs_inf, eval = FALSE}
exp_design <- data.frame(Temperature = factor(c("Ambient", "Ambient", "Ambient",
                                         "Ambient", "Ambient", "Ambient",
                                         "Ambient", "Ambient", "Ambient",
                                         "Ambient", "low", "low",
                                         "Ambient", "low", "low",
                                         "Ambient", "low", "low",
                                         "Ambient", "elev", "Ambient",
                                         "elev", "Ambient", "elev")),
                         crab = factor(c(rep("A", times = 3),
                                         rep("B", times = 3),
                                         rep("C", times = 3),
                                         rep("D", times = 3),
                                         rep("E", times = 3),
                                         rep("F", times = 3),
                                         rep("G", times = 2),
                                         rep("H", times = 2),
                                         rep("I", times = 2))),
                         infection = factor(c(rep("Inf", times = 9),
                                              rep("Uninf", times = 3),
                                              rep("Inf", times = 3),
                                              rep("Uninf", times = 3),
                                              rep("Inf", times = 6))))

deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/all_indiv_libraries/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/all_indiv_libraries/infection_as_var/",
               variable = "infection")
```

#### Hematodinium infection level as variable

Hematodinium infection level was quantified using qPCR at a single time point for each crab. Levels can be found at [this link](https://github.com/crmateo/crab-capstone/blob/main/data/hematqpcr_crabRNA.csv).

The middle number in Sample ID corresponds to the Sample IDs used in this script (i.e. 6203_113_9  = Sample 113). As another note, the last digit corresponds to the experiment day. However, rather than counting from the first day of temperature manipulation, this counts from the first day the crabs were present in the tank. Essentially, it includes the 9-day acclimation period. Therefore, _9 = Day 0, _12 = Day 2, and _26 = Day 17

qPCR quantification (units presumed to be ng/ul)

Crab A = 1119

Crab B = 105477

Crab C = 333000

Crab D = 380502

Crab E = 1550

Crab F = 3069

Crab G = 4515

Crab H = 119500

Crab I = 211000





```{r all_libs_inf_status, eval = FALSE}
exp_design <- data.frame(Temperature = factor(c("Ambient", "Ambient", "Ambient",
                                         "Ambient", "Ambient", "Ambient",
                                         "Ambient", "Ambient", "Ambient",
                                         "Ambient", "low", "low",
                                         "Ambient", "low", "low",
                                         "Ambient", "low", "low",
                                         "Ambient", "elev", "Ambient",
                                         "elev", "Ambient", "elev")),
                         Day = factor(c(0, 2, 17,
                                        0, 2, 17,
                                        0, 2, 17,
                                        0, 2, 17,
                                        0, 2, 17, 
                                        0, 2, 17, 
                                        0, 2, 0, 
                                        2, 0, 2)),
                         hemat_level = factor(c(rep("L", times = 3),
                                               rep("H", times = 9),
                                               rep("L", times = 8),
                                               rep("H", times = 4))))

deseq_analysis(kallisto_path = "../output/kallisto_matrices/cbai_transcriptomev2.0/all_indiv_libraries/kallisto.isoform.counts.matrix",
               experiment_table = exp_design,
               output_path = "../graphs/DESeq2_output/cbai_transcriptomev2.0/all_indiv_libraries/hemat_level_as_var/",
               variable = "hemat_level")
```


### All Samples

The purpose of this section is to create a PCA of all libraries. Each point would be one library. This lets us visualize what variables are influencing variance.

Because of this, we'll actually run DESeq more directly rather than calling the deseq_analysis() function - no need for a lot of the typical DESeq2 outputs. That'll also let us use ggplotly() to create a more interactive (and thus easier to visualize) PCA.

After that, we'll also calculate the plasticity by getting the data from our PCA and calculating the mean distance between each point (using PC1/PC2) and the centroid of that crab.

```{r}
# Create experimental table. Again, order should correspond to order of columns in our data file

exp_design <- data.frame(Temperature = factor(c("Ambient", "Ambient", "Ambient",
                                         "Ambient", "Ambient", "Ambient",
                                         "Ambient", "Ambient", "Ambient",
                                         "Ambient", "low", "low",
                                         "Ambient", "low", "low",
                                         "Ambient", "low", "low",
                                         "Ambient", "elev", "Ambient",
                                         "elev", "Ambient", "elev")),
                         Day = factor(c(0, 2, 17,
                                        0, 2, 17,
                                        0, 2, 17,
                                        0, 2, 17,
                                        0, 2, 17, 
                                        0, 2, 17, 
                                        0, 2, 0, 
                                        2, 0, 2)),
                         hemat_level = factor(c(rep("L", times = 3),
                                                rep("H", times = 9),
                                                rep("L", times = 8),
                                                rep("H", times = 4))),
                         crab = factor(c(rep("A", times = 3),
                                         rep("B", times = 3),
                                         rep("C", times = 3),
                                         rep("D", times = 3),
                                         rep("E", times = 3),
                                         rep("F", times = 3),
                                         rep("G", times = 2),
                                         rep("H", times = 2),
                                         rep("I", times = 2))),
                         infection = factor(c(rep("Inf", times = 9),
                                              rep("Uninf", times = 3),
                                              rep("Inf", times = 3),
                                              rep("Uninf", times = 3),
                                              rep("Inf", times = 6))))


# Read in data
data <- read.table("../output/kallisto_matrices/cbai_transcriptomev2.0/all_indiv_libraries/kallisto.isoform.counts.matrix", header = TRUE, sep = "\t")

# Rename first column
names(data)[1] <- "target_ID"

# Set row names equal to the first column
rownames(data) <- data$target_ID

# Remove the now-irrelevant first column
data <- data[,-1]

# Make sure everything looks okay
print("HEAD")
head(data)

print("STRUCTURE")
print(str(data))

# Round counts to integers - needed for DESeqDataSetFromMatrix()
data <- round(data, digits = 0)

# Rename rows to correspond to library numbers
rownames(exp_design) <- colnames(data)

# Check that experiment_table appears to match columns with matrix from Trinity
print("EXPERIMENTAL DESIGN")
print(exp_design)
  
# Create DESeq object that looks at effect of variable
deseq2.dds <- DESeqDataSetFromMatrix(countData = (data),
                                     colData = exp_design,
                                     design = as.formula("~temp"))

deseq2.dds <- DESeq(deseq2.dds)

#Look at results
deseq2.res <- results(deseq2.dds)
print("SUMMARY:")
print(summary(deseq2.res))

# Transform values for PCA plot
vsd <- vst(deseq2.dds, blind = FALSE)

colData(vsd)

# Plot plotly for PCA
ggplotly(
  plotPCA(vsd, intgroup= "crab") +
    ggtitle("PCA of all crabs for cbai_transcriptomev2.0") +
    geom_point(size = 3, aes(text = colnames(vsd))) +
    theme_minimal(), tooltip = "text")


# Run PCA to create object. This uses the same code found in plotPCA()
rv <- rowVars(assay(vsd))
select <- order(rv, decreasing = TRUE)[seq_len(min(500, 
                                                   length(rv)))]
pca <- prcomp(t(assay(vsd)[select, ]))

# Find the points of each PCA
points <- pca[["x"]]

# Change rownames from sample ID to crab ID
rownames(points) <- exp_design$crab

# Eliminate all columns except PC1 and PC2
points <- points[,1:2]

# Get list of all rownames used (should be all unique crab IDs)
crabs <- unique(rownames(points))

# Initialize a blank dataframe
means <- data.frame(crabs, rep(NA, times = length(crabs)), rep(NA, times = length(crabs)), rep(NA, times = length(crabs)))

# Rename the columns of the blank dataframe
colnames(means) <- c("crabID", "PC1_mean", "PC2_mean", "mean_dist_from_centroid")

for (i in 1:length(crabs)) {
  # Get values that match that particular crab
  crab_pts <- points[rownames(points) == crabs[i], ]
  
  # Get mean of each column. This is the coordinates of the centroid
  means[i, 2] <- mean(crab_pts[, 1])
  means[i, 3] <- mean(crab_pts[, 2])
  
  # Initialize blank vector that's the same length as the number of values that match the crab in question
  dist_vec <- rep(NA, length = nrow(crab_pts))
  
  for (j in 1:nrow(crab_pts)) {
    # Calculate the Euclidean distance from each point to the centroid, use to fill the blank vector
    dist_vec[j] <- sqrt((crab_pts[j,1] - means[i, 2])^2 + (crab_pts[j,2] - means[i, 3])^2)
    
  }
  # Take the mean of the Euclidean distances and put that in Column 4 of the means table
  means[i,4] <- mean(dist_vec)
}

# Remove the middle 2 columns, since we really just want mean distance in the final table
means <- select(means, -c(PC1_mean, PC2_mean))


write.table(means, file = "../graphs/DESeq2_output/cbai_transcriptomev2.0/all_indiv_libraries/PCA_plasticity.txt", row.names = FALSE)

```

# Stage 2: Turning Transcript IDs Into Accession IDs

The previous step produced four tables for each pairwise comparison, as follows. Each table has the same columns: transcript ID, base mean, log2 fold change, lfcSE, stat, p-value, p-adjusted 

1. Data for all differentially-expressed transcripts (DEGlist.txt)

2. Same as 1 but with headers (DEGlist_wcols.txt)

3. Data for all genes (AllGenes.txt)

4. Same as 3, but with headers (AllGenes_wcols.txt)

This  step turns those files (specifically 2 and 4) and turns them into a newline-separated file of UniProt accession IDs by cross-referencing with the BLASTx table for the transcriptome used as an index for kallisto.

### Explanation of transcripts_to_geneIDs:

Turns DESeq2 output to UniProt accessions

Takes three inputs:

1. deseq_filepath: leads to file containing gene list from DESeq2

2. blast_filepath: path that leads to transcript ID/gene ID table

3. output_path: path to new newline-separated file of UniProt accession IDs

### UniProt accession IDs for differentially-expressed transcripts

```{r allDEGs}
# Elevated Day 2 vs. Ambient Day 0+2
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/elev2_vs_amb02_indiv/DEGlist_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/DEG_IDs/elev2_vs_amb02_indiv_DEG_IDs.txt")

# Ambient Day 0+2+17 + Elevated Day 0 + Lowered Day 0 vs. Elevated Day 2
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/amb0217_elev0_low0_vs_elev2/DEGlist_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/DEG_IDs/amb0217_elev0_low0_vs_elev2_DEG_IDs.txt")

# Elevated Day 0 vs. Elevated Day 2
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/elev0_vs_elev2_indiv/DEGlist_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/DEG_IDs/elev0_vs_elev2_indiv_DEG_IDs.txt")

# Ambient Day 0 vs. Ambient Day 2
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/amb0_vs_amb2_indiv/DEGlist_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/DEG_IDs/amb0_vs_amb2_indiv_DEG_IDs.txt")

# Ambient Day 0 vs. Ambient Day 17
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/amb0_vs_amb17_indiv/DEGlist_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/DEG_IDs/amb0_vs_amb17_indiv_DEG_IDs.txt")

# Ambient Day 2 vs. Ambient Day 17
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/amb2_vs_amb17_indiv/DEGlist_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/DEG_IDs/amb2_vs_amb17_indiv_DEG_IDs.txt")

# Ambient Day 2 vs. Elevated Day 2
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/amb2_vs_elev2_indiv/DEGlist_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/DEG_IDs/amb2_vs_elev2_indiv_DEG_IDs.txt")

# Lowered Day 0 vs. Lowered Day 2
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_vs_low2_indiv/DEGlist_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/DEG_IDs/low0_vs_low2_indiv_DEG_IDs.txt")

# Lowered Day 0 vs. Lowered Day 2 + 17
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_vs_low217_indiv/DEGlist_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/DEG_IDs/low0_vs_low217_indiv_DEG_IDs.txt")

# Lowered Day 0 + Ambient Day 0 + 2 + 17 vs. Lowered Day 2 + 17
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_amb0217_vs_low217_indiv/DEGlist_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/DEG_IDs/low0_amb0217_vs_low217_indiv_DEG_IDs.txt")

# Lowered Day 2 + 17 vs. Ambient Day 2+17
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low217_vs_amb217_indiv/DEGlist_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/DEG_IDs/low217_vs_amb217_indiv_DEG_IDs.txt")

# Lowered Day 0 vs. Ambient Day 0
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_vs_amb0_indiv/DEGlist_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/DEG_IDs/low0_vs_amb0_indiv_DEG_IDs.txt")

# Lowered Day 0 vs. Lowered Day 17
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_vs_low17_indiv/DEGlist_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/DEG_IDs/low0_vs_low17_indiv_DEG_IDs.txt")

# Lowered Day 0 + Ambient Day 0 vs. Lowered Day 17 + Ambient Day 17
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_amb0_vs_low17_amb17_indiv/DEGlist_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/DEG_IDs/low0_amb0_vs_low17_amb17_indiv_DEG_IDs.txt")

# Lowered Day 0 + Elevated Day 0 vs. Lowered Day 2 + Elevated Day 2
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_elev0_vs_low2_elev2_indiv/DEGlist_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/DEG_IDs/low0_elev0_vs_low2_elev2_indiv_DEG_IDs.txt")
```

# UniProt accession IDs for all transcripts

```{r allgenes}

# Ambient vs. Low Temperature
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/elev2_vs_amb02_indiv/AllGenes_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/allgenes_IDs/elev2_vs_amb02_indiv_All_GeneIDs.txt")
# Ambient Day 0+2+17 + Elevated Day 0 + Lowered Day 0 vs. Elevated Day 2
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/amb0217_elev0_low0_vs_elev2/AllGenes_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/allgenes_IDs/amb0217_elev0_low0_vs_elev2_All_GeneIDs.txt")
# Elevated Day 0 vs. Elevated Day 2
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/elev0_vs_elev2_indiv/AllGenes_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/allgenes_IDs/elev0_vs_elev2_indiv_All_GeneIDs.txt")
# Ambient Day 0 vs. Ambient Day 2
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/amb0_vs_amb2_indiv/AllGenes_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/allgenes_IDs/amb0_vs_amb2_indiv_All_GeneIDs.txt")
# Ambient Day 0 vs. Ambient Day 17
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/amb0_vs_amb17_indiv/AllGenes_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/allgenes_IDs/amb0_vs_amb17_indiv_All_GeneIDs.txt")
# Ambient Day 2 vs. Ambient Day 17
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/amb2_vs_amb17_indiv/AllGenes_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/allgenes_IDs/amb2_vs_amb17_indiv_All_GeneIDs.txt")
# Ambient Day 2 vs. Elevated Day 2
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/amb2_vs_elev2_indiv/AllGenes_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/allgenes_IDs/amb2_vs_elev2_indiv_All_GeneIDs.txt")

# Lowered Day 0 vs. Lowered Day 2
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_vs_low2_indiv/AllGenes_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/allgenes_IDs/low0_vs_low2_indiv_All_GeneIDs.txt")

# Lowered Day 0 vs. Lowered Day 2 + 17
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_vs_low217_indiv/AllGenes_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/allgenes_IDs/low0_vs_low217_indiv_All_GeneIDs.txt")

# Lowered Day 0 + Ambient Day 0 + 2 + 17 vs. Lowered Day 2 + 17
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_amb0217_vs_low217_indiv/AllGenes_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/allgenes_IDs/low0_amb0217_vs_low217_indiv_All_GeneIDs.txt")

# Lowered Day 2 + 17 vs. Ambient Day 2+17
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low217_vs_amb217_indiv/AllGenes_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/allgenes_IDs/low217_vs_amb217_indiv_All_GeneIDs.txt")

# Lowered Day 0 vs. Ambient Day 0
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_vs_amb0_indiv/AllGenes_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/allgenes_IDs/low0_vs_amb0_indiv_All_GeneIDs.txt")

# Lowered Day 0 vs. Lowered Day 17
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_vs_low17_indiv/AllGenes_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/allgenes_IDs/low0_vs_low17_indiv_All_GeneIDs.txt")

# Lowered Day 0 + Ambient Day 0 vs. Lowered Day 17 + Ambient Day 0
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_amb0_vs_low17_amb17_indiv/AllGenes_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/allgenes_IDs/low0_amb0_vs_low17_amb17_indiv_All_GeneIDs.txt")

# Lowered Day 0 + Elevated Day 0 vs. Lowered Day 2 + Elevated Day 2
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/low0_elev0_vs_low2_elev2_indiv/AllGenes_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/allgenes_IDs/low0_elev0_vs_low2_elev2_indiv_All_GeneIDs.txt")

# All Genes
transcripts_to_geneIDs(deseq_filepath = "../graphs/DESeq2_output/cbai_transcriptomev2.0/all_indiv_libraries/crab_as_var/AllGenes_wcols.txt", 
                       blast_filepath = "../data/cbai_diamond_blastx_table_transcriptomev2.0.txt",
                       output_path = "../output/accession_n_GOids/cbai_transcriptomev2.0/allgenes_IDs/all_indiv_libraries_All_GeneIDs.txt")
```

# Stage 3: Produce Venn diagram of overlap in accession IDs and transcript IDs

This was used once to produce a Venn diagram for a now-outdated comparison. It is not used in any follow-up analyses, and **you can stop here without any downstream ramifications**. However, for posterity and completeness, this is included. Note that **this is also set to eval = FALSE**

```{r venndiagram, eval = FALSE}

#### Creating Venn diagram showing overlap in DEG --------------
# 2 diagrams created in total
#       - Overlap in transcript ID
#       - Overlap in accession IDs (since not all transcript IDs matched to accession IDs)

# PART 1: OVERLAP IN TRANSCRIPT IDs

# Links to DESeq2 outputs containing transcript IDs and data with headers
# If no headers, change second line of import_DEGs() definition
filepath1 <- "../graphs/amb_v_low_day02/DEGlist_wcols.txt"
filepath2 <- "../graphs/day0_day17_ambient/DEGlist_wcols.txt"
filepath3 <- "../graphs/elev_v_amb_day02/DEGlist_wcols.txt"
filepath4 <- "../graphs/elev_v_low_day02/DEGlist_wcols.txt"

# Use our created function to import vector of DEG transcript IDs
# Function present in hematodinium_analysis_functions.R
trans_one <- import_DEGs(filepath1)
trans_two <- import_DEGs(filepath2)
trans_three <- import_DEGs(filepath3)
trans_four <- import_DEGs(filepath4)

# Check how much our time-comparison genes overlap with 
# temperature-comparison genes
sum(trans_two %in% trans_one)
sum(trans_two %in% trans_three)
sum(trans_two %in% trans_four)
# Results are 2, 0, 2 - minimal overlap.
# As a result, only including temp comparisons in Venn diagram

# Create list of all DEGs from temperature comparisons
temp_DEGs <- list(trans_one, trans_three, trans_four)
# Create Venn diagram
venn.diagram(x = temp_DEGs,
             
             # Title and labels
             main = "Day 0/2 Individual DEGs - Transcript ID Overlap",
             main.cex = 1.25,
             cat.pos = c(0, 0, 180),
             category.names = c("Ambient vs. Low",
                                "Elevated vs. Ambient",
                                "Elevated vs. Low"),
             
             # Circles
             lwd = 2, 
             lty = "blank",
             fill = c("#FF949B", "#358AB8", "#FFFDAD"),
             euler.d = TRUE,
             scaled = TRUE,
             
             # Numbers
             cex = 1.5,
             fontface = "bold", 
             fontfamily = "sans",
             
             # Output features
             filename = "TranscriptID_DEGs.png",
             height = 3000, 
             width = 3000,
             resolution = 500,
             output = TRUE)

# How many unique transcript IDs do we have for all our DEGs?
all_IDs <- c(trans_one, trans_two, trans_three, trans_four)
length(unique(all_IDs))
# How many total transcript IDs do we have for our DEGs?
length(all_IDs)
# Percentage that are unique
length(unique(all_IDs)) / length(all_IDs)


# PART 2: OVERLAP IN DEG ACCESSION IDS

# Links to newline-separated file of accession IDs
filepath1 <- "../output/accession_n_GOids/DEG_IDs/Amb_vsLow_DEG_IDs.txt"
filepath2 <- "../output/accession_n_GOids/DEG_IDs/day0_day17_amb_DEG_IDs.txt"
filepath3 <- "../output/accession_n_GOids/DEG_IDs/Elev_vsAmb_DEG_IDs.txt"
filepath4 <- "../output/accession_n_GOids/DEG_IDs/Elev_vsLow_DEG_IDs.txt"

# Use our created function to import vector of DEG Accession IDs
# Using unlist to make it a vector, since we're reading in directly
trans_one <- unlist(read.table(file = filepath1, header = FALSE, sep = "\t"))
trans_two <- unlist(read.table(file = filepath2, header = FALSE, sep = "\t"))
trans_three <- unlist(read.table(file = filepath3, header = FALSE, sep = "\t"))
trans_four <- unlist(read.table(file = filepath4, header = FALSE, sep = "\t"))

# Check how much our time-comparison genes overlap with 
# temperature-comparison genes
sum(trans_two %in% trans_one)
sum(trans_two %in% trans_three)
sum(trans_two %in% trans_four)
# Results are 2, 1, 3. Still minimal, 
# so only including temp comparisons in Venn diagram

# Create list of all DEGs from temperature comparisons
temp_DEGs <- list(trans_one, trans_three, trans_four)
# Create Venn diagram
venn.diagram(x = temp_DEGs,
             
             # Title and labels
             main = "Day 0/2 Individual DEGs - Accession ID Overlap",
             main.cex = 1.25,
             cat.pos = c(-30, 30, 180),
             cat.fontface = "bold",
             category.names = c("Ambient vs. Low",
                                "Elevated vs. Ambient",
                                "Elevated vs. Low"),
             
             # Circles
             lwd = 2, 
             lty = "blank",
             fill = c("#FF949B", "#358AB8", "#FFFDAD"),
             euler.d = TRUE,
             scaled = TRUE,
             
             # Numbers
             cex = 1.5,
             fontface = "bold", 
             fontfamily = "sans",
             
             # Output features
             filename = "AccessionIDs_DEGs.png",
             height = 3000, 
             width = 3000,
             resolution = 500,
             output = TRUE)

# How many unique Accession IDs do we have for our DEGs?
all_IDs <- c(trans_one, trans_two, trans_three, trans_four)
length(unique(all_IDs))
# How many total Accession IDs do we have for our DEGs?
length(all_IDs)
# Percentage that are unique
length(unique(all_IDs)) / length(all_IDs)
```


